---
// Drop this component into your layout to enable astro-animations.
// All required styles and scripts are injected automatically.
---

<script>
  // ==========================================================================
  // constants.ts
  // ==========================================================================

  const DEFAULTS = {
    type: 'fade',
    direction: 'up',
    duration: 700,
    delay: 0,
    easing: 'ease-out-3',
    intensity: 'normal',
    startOpacity: 0,
    repeat: 'once',
    threshold: 0.2,
  } as const;

  const INTENSITY_PRESETS: Record<string, number> = {
    subtle: 0.05,
    normal: 0.15,
    strong: 0.3,
  };

  function resolveIntensity(value: string | number): number {
    if (typeof value === 'number') {
      return Math.max(0, Math.min(1, value));
    }
    return INTENSITY_PRESETS[value] ?? INTENSITY_PRESETS.normal;
  }

  const EASING_MAP: Record<string, string> = {
    'ease-1': 'cubic-bezier(0.25, 0, 0.5, 1)',
    'ease-2': 'cubic-bezier(0.25, 0, 0.4, 1)',
    'ease-3': 'cubic-bezier(0.25, 0, 0.3, 1)',
    'ease-4': 'cubic-bezier(0.25, 0, 0.2, 1)',
    'ease-5': 'cubic-bezier(0.25, 0, 0.1, 1)',
    'ease-in-1': 'cubic-bezier(0.25, 0, 1, 1)',
    'ease-in-2': 'cubic-bezier(0.5, 0, 1, 1)',
    'ease-in-3': 'cubic-bezier(0.7, 0, 1, 1)',
    'ease-in-4': 'cubic-bezier(0.9, 0, 1, 1)',
    'ease-in-5': 'cubic-bezier(1, 0, 1, 1)',
    'ease-out-1': 'cubic-bezier(0, 0, 0.75, 1)',
    'ease-out-2': 'cubic-bezier(0, 0, 0.5, 1)',
    'ease-out-3': 'cubic-bezier(0, 0, 0.3, 1)',
    'ease-out-4': 'cubic-bezier(0, 0, 0.1, 1)',
    'ease-out-5': 'cubic-bezier(0, 0, 0, 1)',
    'ease-in-out-1': 'cubic-bezier(0.1, 0, 0.9, 1)',
    'ease-in-out-2': 'cubic-bezier(0.3, 0, 0.7, 1)',
    'ease-in-out-3': 'cubic-bezier(0.5, 0, 0.5, 1)',
    'ease-in-out-4': 'cubic-bezier(0.7, 0, 0.3, 1)',
    'ease-in-out-5': 'cubic-bezier(0.9, 0, 0.1, 1)',
    'elastic-out-1': 'cubic-bezier(0.5, 0.75, 0.75, 1.25)',
    'elastic-out-2': 'cubic-bezier(0.5, 1, 0.75, 1.25)',
    'elastic-out-3': 'cubic-bezier(0.5, 1.25, 0.75, 1.25)',
    'elastic-out-4': 'cubic-bezier(0.5, 1.5, 0.75, 1.25)',
    'elastic-out-5': 'cubic-bezier(0.5, 1.75, 0.75, 1.25)',
    'elastic-in-1': 'cubic-bezier(0.5, -0.25, 0.75, 1)',
    'elastic-in-2': 'cubic-bezier(0.5, -0.5, 0.75, 1)',
    'elastic-in-3': 'cubic-bezier(0.5, -0.75, 0.75, 1)',
    'elastic-in-4': 'cubic-bezier(0.5, -1, 0.75, 1)',
    'elastic-in-5': 'cubic-bezier(0.5, -1.25, 0.75, 1)',
    'spring-1':
      'linear(0, 0.006, 0.025 2.8%, 0.101 6.1%, 0.539 18.9%, 0.721 25.3%, 0.849 31.5%, 0.937 38.1%, 0.968 41.8%, 0.991 45.7%, 1.006 50.1%, 1.015 55%, 1.017 63.9%, 1.001)',
    'spring-2':
      'linear(0, 0.007, 0.029 2.2%, 0.118 4.7%, 0.625 14.4%, 0.826 19%, 0.902, 0.962, 1.008 26.1%, 1.041 28.7%, 1.064 32.1%, 1.07 36%, 1.061 40.5%, 1.015 53.4%, 0.999 61.6%, 0.995 71.2%, 1)',
    'spring-3':
      'linear(0, 0.009, 0.035 2.1%, 0.141 4.4%, 0.723 12.9%, 0.938 16.7%, 1.017, 1.077, 1.121, 1.149 24.3%, 1.159, 1.163, 1.161, 1.154 29.9%, 1.129 32.8%, 1.051 39.6%, 1.017 43.1%, 0.991, 0.977 51%, 0.974 53.8%, 0.975 57.1%, 0.997 69.8%, 1.003 76.9%, 1)',
    'spring-4':
      'linear(0, 0.009, 0.037 1.7%, 0.153 3.6%, 0.776 10.3%, 1.001, 1.142 16%, 1.185, 1.209 19%, 1.215 19.9% 20.8%, 1.199, 1.165 25%, 1.056 30.3%, 1.008 33%, 0.973, 0.955 39.2%, 0.953 41.1%, 0.957 43.3%, 0.998 53.3%, 1.009 59.1% 63.7%, 0.998 78.9%, 1)',
    'spring-5':
      'linear(0, 0.01, 0.04 1.6%, 0.161 3.3%, 0.816 9.4%, 1.046, 1.189 14.4%, 1.231, 1.254 17%, 1.259, 1.257 18.6%, 1.236, 1.194 22.3%, 1.057 27%, 0.999 29.4%, 0.955 32.1%, 0.942, 0.935 34.9%, 0.933, 0.939 38.4%, 1 47.3%, 1.011, 1.017 52.6%, 1.016 56.4%, 1 65.2%, 0.996 70.2%, 1.001 87.2%, 1)',
    spring:
      'linear(0, 0.009, 0.035 2.1%, 0.141 4.4%, 0.723 12.9%, 0.938 16.7%, 1.017, 1.077, 1.121, 1.149 24.3%, 1.159, 1.163, 1.161, 1.154 29.9%, 1.129 32.8%, 1.051 39.6%, 1.017 43.1%, 0.991, 0.977 51%, 0.974 53.8%, 0.975 57.1%, 0.997 69.8%, 1.003 76.9%, 1)',
    'bounce-1':
      'linear(0, 0.004, 0.016, 0.035, 0.063, 0.098, 0.141, 0.191, 0.25, 0.316, 0.391 36.8%, 0.563, 0.766, 1 58.8%, 0.946, 0.908 69.1%, 0.895, 0.885, 0.879, 0.878, 0.879, 0.885, 0.895, 0.908 89.7%, 0.946, 1)',
    'bounce-2':
      'linear(0, 0.004, 0.016, 0.035, 0.063, 0.098, 0.141 15.1%, 0.25, 0.391, 0.562, 0.765, 1, 0.892 45.2%, 0.849, 0.815, 0.788, 0.769, 0.757, 0.753, 0.757, 0.769, 0.788, 0.815, 0.85, 0.892 75.2%, 1 80.2%, 0.973, 0.954, 0.943, 0.939, 0.943, 0.954, 0.973, 1)',
    'bounce-3':
      'linear(0, 0.004, 0.016, 0.035, 0.062, 0.098, 0.141 11.4%, 0.25, 0.39, 0.562, 0.764, 1 30.3%, 0.847 34.8%, 0.787, 0.737, 0.699, 0.672, 0.655, 0.65, 0.656, 0.672, 0.699, 0.738, 0.787, 0.847 61.7%, 1 66.2%, 0.946, 0.908, 0.885 74.2%, 0.879, 0.878, 0.879, 0.885 79.5%, 0.908, 0.946, 1 87.4%, 0.981, 0.968, 0.96, 0.957, 0.96, 0.968, 0.981, 1)',
    'bounce-4':
      'linear(0, 0.004, 0.016 3%, 0.062, 0.141, 0.25, 0.391, 0.562 18.2%, 1 24.3%, 0.81, 0.676 32.3%, 0.629, 0.595, 0.575, 0.568, 0.575, 0.595, 0.629, 0.676 48.2%, 0.811, 1 56.2%, 0.918, 0.86, 0.825, 0.814, 0.825, 0.86, 0.918, 1 77.2%, 0.94 80.6%, 0.925, 0.92, 0.925, 0.94 87.5%, 1 90.9%, 0.974, 0.965, 0.974, 1)',
    'bounce-5':
      'linear(0, 0.004, 0.016 2.5%, 0.063, 0.141, 0.25 10.1%, 0.562, 1 20.2%, 0.783, 0.627, 0.534 30.9%, 0.511, 0.503, 0.511, 0.534 38%, 0.627, 0.782, 1 48.7%, 0.892, 0.815, 0.769 56.3%, 0.757, 0.753, 0.757, 0.769 61.3%, 0.815, 0.892, 1 68.8%, 0.908 72.4%, 0.885, 0.878, 0.885, 0.908 79.4%, 1 83%, 0.954 85.5%, 0.943, 0.939, 0.943, 0.954 90.5%, 1 93%, 0.977, 0.97, 0.977, 1)',
  };

  const VALID_EASINGS = new Set<string>(Object.keys(EASING_MAP));

  // ==========================================================================
  // observer.ts
  // ==========================================================================

  const VALID_TYPES = new Set<string>([
    'fade',
    'slide',
    'bounce',
    'zoom',
    'flip',
    'fold',
    'roll',
  ]);
  const VALID_DIRECTIONS = new Set<string>(['up', 'down', 'left', 'right']);
  const VALID_INTENSITIES = new Set<string>(Object.keys(INTENSITY_PRESETS));

  const ROTATION_PRESETS: Record<string, number> = {
    subtle: 45,
    normal: 90,
    strong: 180,
  };

  function parseAnimateConfig(el: HTMLElement) {
    const type = el.dataset.animate;
    if (!type || !VALID_TYPES.has(type)) return null;

    const dir = el.dataset.animateDirection;
    const easing = el.dataset.animateEasing;
    const rawIntensity = el.dataset.animateIntensity;
    const repeat = el.dataset.animateRepeat;

    let intensity: string | number = DEFAULTS.intensity;
    if (rawIntensity) {
      if (VALID_INTENSITIES.has(rawIntensity)) {
        intensity = rawIntensity;
      } else {
        const num = Number(rawIntensity);
        if (!Number.isNaN(num) && num >= 0 && num <= 1) {
          intensity = num;
        }
      }
    }

    return {
      type,
      direction: dir && VALID_DIRECTIONS.has(dir) ? dir : DEFAULTS.direction,
      duration: Number(el.dataset.animateDuration) || DEFAULTS.duration,
      delay: Number(el.dataset.animateDelay) || DEFAULTS.delay,
      easing: easing && VALID_EASINGS.has(easing) ? easing : DEFAULTS.easing,
      intensity,
      startOpacity:
        el.dataset.animateOpacity !== undefined
          ? Number(el.dataset.animateOpacity)
          : DEFAULTS.startOpacity,
      repeat: repeat === 'every' ? 'every' : 'once',
      threshold: Number(el.dataset.animateThreshold) || DEFAULTS.threshold,
    };
  }

  function parseStaggerConfig(el: HTMLElement) {
    const val = el.dataset.animateStagger;
    if (val === undefined) return null;
    const from = el.dataset.animateStaggerFrom;
    return {
      duration: Number(val) || 100,
      from: ['first', 'last', 'center'].includes(from ?? '') ? from : 'first',
    };
  }

  const ANIMATION_PROPS = [
    '--animate-duration',
    '--animate-delay',
    '--animate-easing',
    '--animate-start-opacity',
    '--animate-translate',
    '--animate-scale',
    '--animate-rotate',
    'will-change',
  ] as const;

  function promoteElement(el: HTMLElement): void {
    el.style.willChange = 'opacity, transform';
  }

  function listenForAnimationEnd(el: HTMLElement): void {
    el.addEventListener('animationend', () => { el.style.willChange = ''; }, { once: true });
  }

  function intensityToRotate(value: string | number): number {
    if (typeof value === 'string') {
      return ROTATION_PRESETS[value] ?? ROTATION_PRESETS.normal;
    }
    return Math.max(0, Math.min(1, value)) * 180;
  }

  function applyAnimationProperties(
    el: HTMLElement,
    config: ReturnType<typeof parseAnimateConfig>,
    extraDelay = 0,
  ): void {
    if (!config) return;
    const style = el.style;
    const totalDelay = config.delay + extraDelay;
    style.setProperty('--animate-duration', `${config.duration}ms`);
    style.setProperty('--animate-delay', `${totalDelay}ms`);
    style.setProperty('--animate-easing', EASING_MAP[config.easing] ?? EASING_MAP[DEFAULTS.easing]);
    style.setProperty('--animate-start-opacity', String(config.startOpacity));
    const n = resolveIntensity(config.intensity);
    style.setProperty('--animate-translate', `${n * 100}vh`);
    style.setProperty('--animate-scale', String(1 - n));
    style.setProperty('--animate-rotate', `${intensityToRotate(config.intensity)}deg`);
  }

  function clearAnimationProperties(el: HTMLElement): void {
    for (const prop of ANIMATION_PROPS) {
      el.style.removeProperty(prop);
    }
  }

  const allObservers: IntersectionObserver[] = [];
  const thresholdCache = new Map<number, IntersectionObserver>();
  let repeatElements = new Set<HTMLElement>();
  let animatedElements = new Set<HTMLElement>();

  function getOrCreateObserver(threshold: number): IntersectionObserver {
    const existing = thresholdCache.get(threshold);
    if (existing) return existing;

    const observer = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          const el = entry.target as HTMLElement;
          if (entry.isIntersecting) {
            if (animatedElements.has(el) && !repeatElements.has(el)) continue;
            promoteElement(el);
            el.classList.add('is-animating');
            listenForAnimationEnd(el);
            animatedElements.add(el);
            if (!repeatElements.has(el)) observer.unobserve(el);
          } else if (repeatElements.has(el)) {
            el.classList.remove('is-animating');
          }
        }
      },
      { threshold },
    );

    thresholdCache.set(threshold, observer);
    allObservers.push(observer);
    return observer;
  }

  function setupStaggerGroup(
    parent: HTMLElement,
    staggerCfg: ReturnType<typeof parseStaggerConfig>,
  ): void {
    if (!staggerCfg) return;
    const children = Array.from(
      parent.querySelectorAll<HTMLElement>(':scope > [data-animate]'),
    );
    if (children.length === 0) return;

    let indices: number[];
    if (staggerCfg.from === 'last') {
      indices = children.map((_, i) => children.length - 1 - i);
    } else if (staggerCfg.from === 'center') {
      const center = (children.length - 1) / 2;
      indices = children.map((_, i) => Math.abs(i - center));
    } else {
      indices = children.map((_, i) => i);
    }

    for (let i = 0; i < children.length; i++) {
      const child = children[i];
      const config = parseAnimateConfig(child);
      if (!config) continue;
      applyAnimationProperties(child, config, indices[i] * staggerCfg.duration);
    }

    const observer = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            for (const child of children) {
              promoteElement(child);
              child.classList.add('is-animating');
              listenForAnimationEnd(child);
              animatedElements.add(child);
            }
            observer.unobserve(entry.target);
          }
        }
      },
      { threshold: 0.1 },
    );

    observer.observe(parent);
    allObservers.push(observer);
  }

  function initInViewAnimations(): void {
    const staggerParents = document.querySelectorAll<HTMLElement>('[data-animate-stagger]');
    const staggerChildSet = new Set<HTMLElement>();

    for (const parent of staggerParents) {
      const staggerCfg = parseStaggerConfig(parent);
      if (!staggerCfg) continue;
      setupStaggerGroup(parent, staggerCfg);
      for (const child of parent.querySelectorAll<HTMLElement>(':scope > [data-animate]')) {
        staggerChildSet.add(child);
      }
    }

    const allAnimated = document.querySelectorAll<HTMLElement>('[data-animate]');
    for (const el of allAnimated) {
      if (staggerChildSet.has(el)) continue;
      const config = parseAnimateConfig(el);
      if (!config) continue;
      applyAnimationProperties(el, config);
      if (config.repeat === 'every') repeatElements.add(el);
      getOrCreateObserver(config.threshold).observe(el);
    }
  }

  function destroyInViewAnimations(): void {
    for (const observer of allObservers) observer.disconnect();
    allObservers.length = 0;
    thresholdCache.clear();
    repeatElements = new Set();
    animatedElements = new Set();
    const allAnimated = document.querySelectorAll<HTMLElement>('[data-animate]');
    for (const el of allAnimated) {
      el.classList.remove('is-animating');
      clearAnimationProperties(el);
    }
  }

  // ==========================================================================
  // init.ts
  // ==========================================================================

  function prefersReducedMotion(): boolean {
    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  }

  function initAnimations(): void {
    if (document.body.hasAttribute('data-animate-ready')) return;

    if (prefersReducedMotion()) {
      const animated = document.querySelectorAll<HTMLElement>('[data-animate]');
      for (const el of animated) {
        el.style.opacity = '1';
        el.style.transform = 'none';
      }
      return;
    }

    initInViewAnimations();
    document.body.setAttribute('data-animate-ready', '');
  }

  function destroyAnimations(): void {
    destroyInViewAnimations();
    document.body.removeAttribute('data-animate-ready');
  }

  document.addEventListener('astro:page-load', initAnimations);
  document.addEventListener('astro:before-swap', destroyAnimations);
  initAnimations();
</script>

<style is:global>
  /* ============================================================
   * _animate-base.css
   *
   * Base styles for scroll-triggered animations.
   * Progressive enhancement: elements are visible by default.
   * JS sets data-animate-ready on <body> after applying initial hidden states.
   * ============================================================ */

  /* Prevent horizontal scrollbar from off-screen translateX (slide/bounce/roll).
     clip avoids creating a scroll container (unlike hidden), so it won't
     interfere with sticky positioning or other layout features. */
  [data-animate-ready] {
    overflow-x: clip;
  }

  /* Custom property defaults */
  [data-animate] {
    --animate-duration: 700ms;
    --animate-delay: 0ms;
    --animate-easing: cubic-bezier(0, 0, 0.3, 1); /* ease-out-3 */
    --animate-start-opacity: 0;
    --animate-translate: 15vh;
    --animate-scale: 0.85;
    --animate-rotate: 90deg;
  }

  /* Hide elements until JS is ready — progressive enhancement guard.
     will-change is set/cleared by JS around animation lifecycle to
     avoid keeping compositor layers allocated permanently. */
  [data-animate-ready] [data-animate] {
    opacity: var(--animate-start-opacity);
  }

  /* 3D perspective for flip/fold is applied via perspective() in keyframes
     rather than the perspective property, which only affects children. */

  /* Fold transform-origin per direction */
  [data-animate="fold"][data-animate-direction="up"],
  [data-animate="fold"]:not([data-animate-direction]) {
    transform-origin: 50% 0%;
  }

  [data-animate="fold"][data-animate-direction="down"] {
    transform-origin: 50% 100%;
  }

  [data-animate="fold"][data-animate-direction="left"] {
    transform-origin: 0% 50%;
  }

  [data-animate="fold"][data-animate-direction="right"] {
    transform-origin: 100% 50%;
  }

  /* ---- Animated state ---- */
  /* The .is-animating class is toggled by the IntersectionObserver */
  [data-animate-ready] [data-animate].is-animating {
    opacity: 1;
    animation-duration: var(--animate-duration);
    animation-timing-function: var(--animate-easing);
    animation-delay: var(--animate-delay);
    animation-fill-mode: both;
  }

  /* Map animation type + direction to the correct @keyframes */
  [data-animate="fade"].is-animating {
    animation-name: fade-in;
  }

  /* Slide */
  [data-animate="slide"].is-animating,
  [data-animate="slide"][data-animate-direction="up"].is-animating {
    animation-name: slide-in-up;
  }
  [data-animate="slide"][data-animate-direction="down"].is-animating {
    animation-name: slide-in-down;
  }
  [data-animate="slide"][data-animate-direction="left"].is-animating {
    animation-name: slide-in-left;
  }
  [data-animate="slide"][data-animate-direction="right"].is-animating {
    animation-name: slide-in-right;
  }

  /* Bounce */
  [data-animate="bounce"].is-animating,
  [data-animate="bounce"][data-animate-direction="up"].is-animating {
    animation-name: bounce-in-up;
  }
  [data-animate="bounce"][data-animate-direction="down"].is-animating {
    animation-name: bounce-in-down;
  }
  [data-animate="bounce"][data-animate-direction="left"].is-animating {
    animation-name: bounce-in-left;
  }
  [data-animate="bounce"][data-animate-direction="right"].is-animating {
    animation-name: bounce-in-right;
  }

  /* Zoom */
  [data-animate="zoom"].is-animating {
    animation-name: zoom-in;
  }

  /* Flip */
  [data-animate="flip"].is-animating,
  [data-animate="flip"][data-animate-direction="up"].is-animating {
    animation-name: flip-in-up;
  }
  [data-animate="flip"][data-animate-direction="down"].is-animating {
    animation-name: flip-in-down;
  }
  [data-animate="flip"][data-animate-direction="left"].is-animating {
    animation-name: flip-in-left;
  }
  [data-animate="flip"][data-animate-direction="right"].is-animating {
    animation-name: flip-in-right;
  }

  /* Fold */
  [data-animate="fold"].is-animating,
  [data-animate="fold"][data-animate-direction="up"].is-animating {
    animation-name: fold-in-up;
  }
  [data-animate="fold"][data-animate-direction="down"].is-animating {
    animation-name: fold-in-down;
  }
  [data-animate="fold"][data-animate-direction="left"].is-animating {
    animation-name: fold-in-left;
  }
  [data-animate="fold"][data-animate-direction="right"].is-animating {
    animation-name: fold-in-right;
  }

  /* Roll */
  [data-animate="roll"].is-animating {
    animation-name: roll-in;
  }

  /* ---- Intensity presets ---- */
  [data-animate-intensity="subtle"] {
    --animate-translate: 5vh;
    --animate-scale: 0.95;
    --animate-rotate: 45deg;
  }

  /* "normal" is the default — values set on [data-animate] above */

  [data-animate-intensity="strong"] {
    --animate-translate: 30vh;
    --animate-scale: 0.7;
    --animate-rotate: 180deg;
  }

  /* ============================================================
   * _animate-keyframes.css
   *
   * CSS @keyframes for all 7 animation types.
   * Intensity is driven by CSS custom properties set on each element
   * by the IntersectionObserver script (--animate-translate, --animate-scale,
   * --animate-rotate). This keeps the keyframes reusable across intensity levels.
   * ============================================================ */

  /* -- Fade ------------------------------------------------------------------ */
  @keyframes fade-in {
    from {
      opacity: var(--animate-start-opacity, 0);
    }
    to {
      opacity: 1;
    }
  }

  /* -- Slide ----------------------------------------------------------------- */
  @keyframes slide-in-up {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: translateY(var(--animate-translate));
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slide-in-down {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: translateY(calc(var(--animate-translate) * -1));
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slide-in-left {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: translateX(var(--animate-translate));
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slide-in-right {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: translateX(calc(var(--animate-translate) * -1));
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* -- Bounce ---------------------------------------------------------------- */
  @keyframes bounce-in-up {
    0% {
      opacity: var(--animate-start-opacity, 0);
      transform: translateY(var(--animate-translate));
    }
    60% {
      opacity: 1;
      transform: translateY(calc(var(--animate-translate) * -0.2));
    }
    80% {
      transform: translateY(calc(var(--animate-translate) * 0.05));
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes bounce-in-down {
    0% {
      opacity: var(--animate-start-opacity, 0);
      transform: translateY(calc(var(--animate-translate) * -1));
    }
    60% {
      opacity: 1;
      transform: translateY(calc(var(--animate-translate) * 0.2));
    }
    80% {
      transform: translateY(calc(var(--animate-translate) * -0.05));
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes bounce-in-left {
    0% {
      opacity: var(--animate-start-opacity, 0);
      transform: translateX(var(--animate-translate));
    }
    60% {
      opacity: 1;
      transform: translateX(calc(var(--animate-translate) * -0.2));
    }
    80% {
      transform: translateX(calc(var(--animate-translate) * 0.05));
    }
    100% {
      transform: translateX(0);
    }
  }

  @keyframes bounce-in-right {
    0% {
      opacity: var(--animate-start-opacity, 0);
      transform: translateX(calc(var(--animate-translate) * -1));
    }
    60% {
      opacity: 1;
      transform: translateX(calc(var(--animate-translate) * 0.2));
    }
    80% {
      transform: translateX(calc(var(--animate-translate) * -0.05));
    }
    100% {
      transform: translateX(0);
    }
  }

  /* -- Zoom ------------------------------------------------------------------ */
  @keyframes zoom-in {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: scale(var(--animate-scale));
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* -- Flip ------------------------------------------------------------------ */
  @keyframes flip-in-up {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateX(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateX(0deg);
    }
  }

  @keyframes flip-in-down {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateX(calc(var(--animate-rotate) * -1));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateX(0deg);
    }
  }

  @keyframes flip-in-left {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateY(calc(var(--animate-rotate) * -1));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateY(0deg);
    }
  }

  @keyframes flip-in-right {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateY(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateY(0deg);
    }
  }

  /* -- Fold ------------------------------------------------------------------ */
  @keyframes fold-in-up {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateX(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateX(0deg);
    }
  }

  @keyframes fold-in-down {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateX(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateX(0deg);
    }
  }

  @keyframes fold-in-left {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateY(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateY(0deg);
    }
  }

  @keyframes fold-in-right {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: perspective(1000px) rotateY(var(--animate-rotate));
    }
    to {
      opacity: 1;
      transform: perspective(1000px) rotateY(0deg);
    }
  }

  /* -- Roll ------------------------------------------------------------------ */
  @keyframes roll-in {
    from {
      opacity: var(--animate-start-opacity, 0);
      transform: translateX(calc(var(--animate-translate) * -1))
        rotate(calc(var(--animate-rotate) * -1));
    }
    to {
      opacity: 1;
      transform: translateX(0) rotate(0deg);
    }
  }

  /* ============================================================
   * _scroll-timeline.css
   *
   * Pure CSS scroll-linked animations using animation-timeline: view().
   * Zero JS overhead — only targets elements with data-scroll-css.
   * Uses --scroll-speed custom property for configurable intensity.
   * ============================================================ */

  /* -- Parallax -------------------------------------------------------------- */
  [data-scroll-effect="parallax"][data-scroll-css] {
    animation: scroll-parallax linear both;
    animation-timeline: view();
    animation-range: entry 0% exit 100%;
  }

  @keyframes scroll-parallax {
    from {
      transform: translateY(var(--scroll-speed, 50px));
    }
    to {
      transform: translateY(calc(var(--scroll-speed, 50px) * -1));
    }
  }

  /* -- Fade ------------------------------------------------------------------ */
  [data-scroll-effect="fade"][data-scroll-css] {
    animation: scroll-fade linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 40%;
  }

  @keyframes scroll-fade {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* -- Scale ----------------------------------------------------------------- */
  [data-scroll-effect="scale"][data-scroll-css] {
    animation: scroll-scale linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 50%;
  }

  @keyframes scroll-scale {
    from {
      transform: scale(0.8);
    }
    to {
      transform: scale(1);
    }
  }

  /* -- Rotate ---------------------------------------------------------------- */
  [data-scroll-effect="rotate"][data-scroll-css] {
    animation: scroll-rotate linear both;
    animation-timeline: view();
    animation-range: entry 0% exit 100%;
  }

  @keyframes scroll-rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(var(--scroll-rotate, 180deg));
    }
  }

  /* -- Blur ------------------------------------------------------------------ */
  [data-scroll-effect="blur"][data-scroll-css] {
    animation: scroll-blur linear both;
    animation-timeline: view();
    animation-range: entry 0% cover 50%;
  }

  @keyframes scroll-blur {
    from {
      filter: blur(10px);
    }
    to {
      filter: blur(0px);
    }
  }

  /* -- Horizontal ------------------------------------------------------------ */
  [data-scroll-effect="horizontal"][data-scroll-css] {
    animation: scroll-horizontal linear both;
    animation-timeline: view();
    animation-range: entry 0% exit 100%;
  }

  @keyframes scroll-horizontal {
    from {
      transform: translateX(calc(var(--scroll-speed, 100px) * -1));
    }
    to {
      transform: translateX(var(--scroll-speed, 100px));
    }
  }

  /* ============================================================
   * _reduced-motion.css
   *
   * Reduced motion: force everything visible, kill all animation.
   * ============================================================ */

  @media (prefers-reduced-motion: reduce) {
    [data-animate] {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
      animation: none !important;
    }

    [data-scroll-effect] {
      transform: none !important;
      filter: none !important;
      animation: none !important;
    }
  }
</style>
